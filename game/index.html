<!DOCTYPE html>
<html>
<head>
    <title>Canvas Game Example</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: black;
        }

        canvas {
            display: block;
            border: 3px white solid;
            background-image: url('images/background1.png');
            background-size: cover;
        }

        #score {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 24px;
            color: #000;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="score">Score: 0</div>
    <script>
        const canvas = document.getElementById("gameCanvas");
        const context = canvas.getContext("2d");
        canvas.width = 800;
        canvas.height = 500;

        let collisionAlertShown = false;
        let winAlertShown = false;

        const keys = {};
        window.addEventListener("keydown", (event) => { keys[event.key] = true; });
        window.addEventListener("keyup", (event) => { keys[event.key] = false; });

        const playerImage = new Image();
        playerImage.src = "images/Miata-1.png";
        const enemyImage = new Image();
        enemyImage.src = "images/Prius-1.png";
        const backgroundImage1 = new Image();
        backgroundImage1.src = "images/npd.png";
        const backgroundImage2 = new Image();
        backgroundImage2.src = "images/sbhs.png";

        const background = {
            x: 0,
            y: 0,
            speed: 0.5,
            currentBackground: backgroundImage1
        };

        const player = {
            x: canvas.width / 2,
            y: canvas.height - 50,
            width: 100,
            height: 50,
            color: "blue",
            speed: 6,
            image: playerImage
        };

        const enemy = {
            x: canvas.width / 2,
            y: 380,
            width: 100,
            height: 50,
            color: "red",
            image: enemyImage,
            speed: 2
        };

        let score = 0;

        

        function updateBackground() {
            background.x -= player.speed * background.speed;
            if (background.x < -background.currentBackground.width) {
                background.x = 0;
            }
        }

        function drawBackground() {
            context.drawImage(background.currentBackground, background.x, background.y,
                              canvas.width + background.currentBackground.width, canvas.height / 1.8);
        }

        function updateScore() {
            score++;
            document.getElementById("score").textContent = `Score: ${score}`;
            if (score >= 3000) {
                background.currentBackground = backgroundImage2;
            }
            enemy.speed = 1 + score / 10000;
            
            if (score >= 5000 && !winAlertShown) {
                winAlertShown = true;
                alert("Congratulations! You won the game!");
                location.reload();
            }
        }

        function updatePlayer() {
            if (keys["w"] && player.y > 270) player.y -= player.speed;
            if (keys["s"] && player.y < 450) player.y += player.speed;
            if (keys["a"] && player.x > 0) player.x -= player.speed;
            if (keys["d"] && player.x < canvas.width) player.x += player.speed;
            if (player.x < player.width / 2) player.x = player.width / 2;
            if (player.x > canvas.width - player.width / 2) player.x = canvas.width - player.width / 2;
            if (player.y < player.height / 2) player.y = player.height / 2;
            if (player.y > canvas.height - player.height / 2) player.y = canvas.height - player.height / 2;
        }

        function drawPlayer() {
            context.save(); // Save the current context state
            // Flip horizontally if "A" key is pressed
            if (keys["a"]) {
                context.scale(-1, 1);
                context.drawImage(player.image, -player.x - player.width / 2, player.y - player.height / 2,
                                  player.width, player.height);
            } else {
                context.drawImage(player.image, player.x - player.width / 2, player.y - player.height / 2,
                                  player.width, player.height);
            }
            context.restore(); // Restore the context state
        }

        function drawEnemy() {
            context.save(); // Save the current context state
            if (enemy.x > player.x) { // Flip horizontally if enemy is moving left
                context.scale(-1,1);
                context.drawImage(enemy.image, -enemy.x - enemy.width / 2, enemy.y - enemy.height / 2,
                                  enemy.width, enemy.height);
            } else {
                context.drawImage(enemy.image, enemy.x - enemy.width / 2, enemy.y - enemy.height / 2,
                                  enemy.width, enemy.height);
            }
            context.restore(); // Restore the context state
        
       
        }
        function updateEnemy() {
            const dx = player.x - enemy.x;
            const dy = player.y - enemy.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            if (distance > 1) {
                enemy.x += (dx / distance) * enemy.speed;
                enemy.y += (dy / distance) * enemy.speed;
            }
        }

        function checkCollision() {
            const playerLeft = player.x - player.width / 2;
            const playerRight = player.x + player.width / 2;
            const playerTop = player.y - player.height / 2;
            const playerBottom = player.y + player.height / 2;

            const enemyLeft = enemy.x - enemy.width / 2;
            const enemyRight = enemy.x + enemy.width / 2;
            const enemyTop = enemy.y - enemy.height / 2;
            const enemyBottom = enemy.y + enemy.height / 2;

            if (
                !collisionAlertShown &&
                playerLeft < enemyRight &&
                playerRight > enemyLeft &&
                playerTop < enemyBottom &&
                playerBottom > enemyTop
            ) {
                // Collision detected
                collisionAlertShown = true; // Set the flag to true
                alert("You got hit by the enemy! Game over.");
                location.reload();
            }
        }

        function setEnemyPositionAwayFromPlayer() {
            const safeDistance = 200;
            do {
                enemy.x = Math.random() * canvas.width;
            } while (Math.abs(enemy.x - player.x) < safeDistance);
        }

        setEnemyPositionAwayFromPlayer();

        function gameLoop() {
            context.clearRect(0, 0, canvas.width, canvas.height);
            updateBackground();
            drawBackground();
            updatePlayer();
            drawPlayer();
            updateEnemy();
            drawEnemy();
            checkCollision();
            updateScore();
            requestAnimationFrame(gameLoop);
        }

        gameLoop();
    </script>
</body>
</html>
