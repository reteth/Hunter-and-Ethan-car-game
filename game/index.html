<!DOCTYPE html>
<html>
<head>
    <title>Canvas Game Example</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-image: url('images/map1.png');
            background-size: cover;
        }

        canvas {
            display: block;
            border: 3px white solid;
            background-image: url('images/background1.png');
            background-size: cover;
        }

        #score {
            position: absolute;
            top: 50px; 
            left: 50px; 
            font-size: 50px;
            color: white;
            background-color: black;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="score">Score: 0</div>
    <script>
        const canvas = document.getElementById("gameCanvas");
        const context = canvas.getContext("2d");
        canvas.width = 800;
        canvas.height = 500;

        let collisionAlertShown = false;
        let winAlertShown = false;
        let enableEnemy2 = false; 

        const difficulty = prompt("Choose a difficulty ('easy' or 'hard'):");
        if (difficulty && difficulty.toLowerCase() === "hard") {
            enableEnemy2 = true;
        }

        const keys = {};
        window.addEventListener("keydown", (event) => { keys[event.key] = true; });
        window.addEventListener("keyup", (event) => { keys[event.key] = false; });

        const playerImage = new Image();
        playerImage.src = "images/Miata-1.png";
        const enemyImage = new Image();
        enemyImage.src = "images/Prius-1.png";
        const enemyImage2 = new Image();
        enemyImage2.src = "images/Prius-1.png";
        const backgroundImage1 = new Image();
        backgroundImage1.src = "images/npd.png";
        const backgroundImage2 = new Image();
        backgroundImage2.src = "images/sbhs.png";
        const backgroundImage3 = new Image();
        backgroundImage3.src = "images/nash.png";

        const background = {
            x: 0,
            y: 0,
            speed: 0.05,
            currentBackground: backgroundImage1
        };

        const player = {
            x: canvas.width / 2,
            y: canvas.height - 50,
            width: 100,
            height: 50,
            color: "blue",
            speed: 6,
            image: playerImage
        };

        const enemy = {
            x: canvas.width / 2,
            y: 380,
            width: 100,
            height: 50,
            color: "red",
            image: enemyImage,
            speed: 2
        };

        const enemy2 = {
            x: Math.random() * canvas.width, // Initial x position (random)
            y: -100, // Start above the canvas
            width: 100,
            height: 50,
            color: "green", // Modify the color as needed
            image: enemyImage2,
            speed: 2 // Enemy movement speed
        };
        

        let score = 0;

        function updateBackground() {
            background.x -= player.speed * background.speed;
            if (background.x < -background.currentBackground.width) {
                background.x = 0;
            }
        }

        function drawBackground() {
            context.drawImage(background.currentBackground, background.x, background.y,
                              canvas.width + background.currentBackground.width, canvas.height / 1.8);
        }

        function updateScore() {
            score++;
            document.getElementById("score").textContent = `Score: ${score}`;
            if (score >= 1900) {
                background.currentBackground = backgroundImage2;
            }
            if (score >= 3100) {
                background.currentBackground = backgroundImage3;
            }
            enemy.speed = 1 + score / 10000;

            if (score >= 3800 && !winAlertShown) {
                winAlertShown = true;
                alert("You ate KFC with Nash, you are fat");
                location.reload();
            }
        }

        function updatePlayer() {
            if (keys["w"] && player.y > 270) player.y -= player.speed;
            if (keys["s"] && player.y < 450) player.y += player.speed;
            if (keys["a"] && player.x > 0) player.x -= player.speed;
            if (keys["d"] && player.x < canvas.width) player.x += player.speed;
            if (player.x < player.width / 2) player.x = player.width / 2;
            if (player.x > canvas.width - player.width / 2) player.x = canvas.width - player.width / 2;
            if (player.y < player.height / 2) player.y = player.height / 2;
            if (player.y > canvas.height - player.height / 2) player.y = canvas.height - player.height / 2;
        }

        function drawPlayer() {
            context.save();
            if (keys["a"]) {
                context.scale(-1, 1);
                context.drawImage(player.image, -player.x - player.width / 2, player.y - player.height / 2,
                                  player.width, player.height);
            } else {
                context.drawImage(player.image, player.x - player.width / 2, player.y - player.height / 2,
                                  player.width, player.height);
            }
            context.restore();
        }

        function drawEnemy() {
            context.save();
            if (enemy.x > player.x) {
                context.scale(-1, 1);
                context.drawImage(enemy.image, -enemy.x - enemy.width / 2, enemy.y - enemy.height / 2,
                                  enemy.width, enemy.height);
            } else {
                context.drawImage(enemy.image, enemy.x - enemy.width / 2, enemy.y - enemy.height / 2,
                                  enemy.width, enemy.height);
            }
            context.restore();
        }

        function updateEnemy() {
            const dx = player.x - enemy.x;
            const dy = player.y - enemy.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            if (distance > 1) {
                enemy.x += (dx / distance) * enemy.speed;
                enemy.y += (dy / distance) * enemy.speed;
            }
        }

        function updateEnemy2() {
            enemy2.y += enemy2.speed;

            // Reset the second enemy position when it goes below the canvas
            if (enemy2.y > canvas.height) {
                enemy2.x = Math.random() * canvas.width;
                enemy2.y = -100;
            }
        }
        function drawEnemy2() {
            context.fillStyle = enemy2.color;
            context.drawImage(enemy2.image, enemy2.x - enemy2.width / 2, enemy2.y - enemy2.height / 2, enemy2.width, enemy2.height);
        }

        function checkCollision() {
            const playerLeft = player.x - player.width / 2;
            const playerRight = player.x + player.width / 2;
            const playerTop = player.y - player.height / 2;
            const playerBottom = player.y + player.height / 2;

            const enemyLeft = enemy.x - enemy.width / 2;
            const enemyRight = enemy.x + enemy.width / 2;
            const enemyTop = enemy.y - enemy.height / 2;
            const enemyBottom = enemy.y + enemy.height / 2;

            if (
                !collisionAlertShown &&
                playerLeft < enemyRight &&
                playerRight > enemyLeft &&
                playerTop < enemyBottom &&
                playerBottom > enemyTop
            ) {
                collisionAlertShown = true;
                alert("Game over your score was " + score);
                location.reload();
            }
        }
        function checkCollision2() {
            const playerLeft = player.x - player.width / 2;
            const playerRight = player.x + player.width / 2;
            const playerTop = player.y - player.height / 2;
            const playerBottom = player.y + player.height / 2;

            const enemy2Left = enemy2.x - enemy2.width / 2;
            const enemy2Right = enemy2.x + enemy2.width / 2;
            const enemy2Top = enemy2.y - enemy2.height / 2;
            const enemy2Bottom = enemy2.y + enemy2.height / 2;

            if (
                !collisionAlertShown &&
                playerLeft < enemy2Right &&
                playerRight > enemy2Left &&
                playerTop < enemy2Bottom &&
                playerBottom > enemy2Top
            ) {
                collisionAlertShown = true;
                alert("Game over your score was " + score);
                location.reload();
            }
        }

      

        function setEnemyPositionAwayFromPlayer() {
            const safeDistance = 350;
            do {
                enemy.x = Math.random() * canvas.width;
            } while (Math.abs(enemy.x - player.x) < safeDistance);
        }

        setEnemyPositionAwayFromPlayer();


        function gameLoop() {
            context.clearRect(0, 0, canvas.width, canvas.height);
            updateBackground();
            drawBackground();
            updatePlayer();
            drawPlayer();
            updateEnemy();
            drawEnemy();

            if (enableEnemy2) {
                updateEnemy2(); 
                drawEnemy2();   
                checkCollision2(); 
            }

            checkCollision();
            updateScore();
            requestAnimationFrame(gameLoop);
        }
        
        alert("Welcome to Invercargill driving sim!");
        alert("W A S D to move");
        alert("Get to the Creedy's house for KFC")
         
        gameLoop();
    </script>
</body>
</html>
